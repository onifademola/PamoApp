
@{
    ViewBag.Title = "Lab";
}

<script type="text/javascript">
    $(document).ready(
        function () {
            $("#txt1").html("Admission");
            $("#txt2").html("(Attend to Patients on Admission)");
            //$("#txtWarning").html("System failure imminent, carefully change COMPUTE TYPE & CLASS HIERARCHY under strict change request, and only when agreed and advised by the SCHOOL ADMINISTRATORS!");
        });
</script>


<div id="pageDP">
    <div class="col-md-4" id="pageGridPatient">

        @(Html.Kendo().Grid<Repo.Models.vwFlowQueueAttendance>()
                .Name("GridAdmsn")
                .NoRecords("No patient placed on admission found")
                .Columns(columns =>
                {
                    columns.Bound(c => c.AttCArdNumber).Title("");
                    columns.Bound(c => c.FirstName).Title("");
                    columns.ForeignKey(p => p.FQCurrentSTatus, (System.Collections.IEnumerable)ViewData["vstatus"], "Key", "Value")
                    .Title("");
                    columns.Bound(c => c.FQTimeStamp).Format("{0:dd/MM/yyyy hh:mm: tt}").Title("");
                    columns.Bound(c => c.FQLastUpdatedBy).Title("");
                })
                .ToolBar(toolbar =>
                {
                toolbar.Template(@<text>
            <div class="row">
                <div class="col-sm-4 col-md-6 toolbar">
                    @(Html.Kendo().Button()
                        .Name("iconButton")
                        .Tag("a")
                        .Icon("refresh")
                        .Content("Discharge & Send to Pharmacy")
                        .Events(e => e.Click("csonClick"))
                        //.Content("<span class='fa-share' title='Click to run process'>Send to Consulting</span>")

                    )
                </div>
            </div>
                </text>);
                })
                .Resizable(r => r.Columns(true))
                .Scrollable(sc => sc.Endless(true))
                .Sortable()
                .Selectable(selectable => selectable
                .Mode(GridSelectionMode.Single))
                .Mobile(MobileMode.Auto)
                .Pageable(p => p.Numeric(false)
                    .PreviousNext(false)
                    .Refresh(true)
                )
                .Events(ev => ev.Change("onChange"))
                .DataSource(dataSource => dataSource
                .Ajax()
                .Batch(false)
                .ServerOperation(false)
                .PageSize(50)
                .Events(e =>
                {
                    e.Error("error_handler");
                })
                .Model(model =>
                {
                    model.Id(p => p.FQID);
                })
                .Read(read => read.Action("Read_GetAdmissionFlowQueues", "ProcessFlow"))
                )
        )
    </div>

    <div class="col-md-8" id="admissionList">
        @*@Html.Partial("_PartialPageSelection")*@
        @(Html.Kendo().Grid<Repo.DTOs.dto_Admission>()
                .Name("GridBV")
                .NoRecords("No admission found")
                .Columns(columns =>
                {
                    columns.Bound(c => c.ClinicWardID);
                    columns.Bound(c => c.ActivityType);
                    columns.ForeignKey(c => c.StatusID, (System.Collections.IEnumerable)ViewData["admstatus"], "Value", "Text")
                    .Title("Admission Status");
                    columns.Bound(c => c.C_Date).Format("{0:dd/MM/yyyy hh:mm: tt}").Title("Date Admitted");
                    columns.Bound(c => c.Remark);
                })
                .ToolBar(toolbar =>
                {
                    toolbar.Create();
                    toolbar.Save();
                    toolbar.Excel();
                })
                .Editable(editable => editable.Mode(GridEditMode.InCell))
                .AutoBind(false)
                .Resizable(r => r.Columns(true))
                .Scrollable(sc => sc.Endless(true))
                .Sortable()
                .Selectable(selectable => selectable
                .Mode(GridSelectionMode.Single))
                .Mobile(MobileMode.Auto)
                .Pageable(p => p.Numeric(false)
                    .PreviousNext(false)
                    .Refresh(true)
                )
                .DataSource(dataSource => dataSource
                .Ajax()
                .Batch(false)
                .ServerOperation(false)
                .PageSize(50)
                .Events(e =>
                {
                    e.Error("error_handler");
                })
                .Model(model =>
                {
                    model.Id(p => p.ID);
                    model.Field(p => p.C_Date).Editable(false);
                })
                    .Read(read => read.Action("Admission_Read", "Consultation").Data("filterData"))
                    .Update(update => update.Action("Admission_BatchUpdate", "Consultation"))
                    .Create(c => c.Action("Admission_Create", "Consultation").Data("filterData"))
                    .Destroy(d => d.Action("Admission_Read", "Consultation"))
                )
        )
        <script>
            function filterData() {
                var grid = $("#GridAdmsn").data("kendoGrid");
                var selectedItem = grid.dataItem(grid.select());
                if (selectedItem != null) {
                    return {
                        attId: selectedItem.AttdID
                    };
                } else {
                    return {
                        attId: 0
                    };
                }
            };
        </script>
    </div>

</div>

@Html.Partial("~/Views/Shared/_PartialProgressBar.cshtml")

<script src="~/Scripts/appjs/admission.js"></script>
<script src="~/Scripts/custom/progressBar.js"></script>

